{"version":3,"sources":["../../dist-esnext/users/userSchema.js"],"names":["expiresIn","UserSchema","userApp","authedUser","log","userType","name","fields","id","type","userName","email","emailConfirmed","displayName","imgUrl","errors","errorType","propName","errorMsg","userConnection","nodeType","getUserConnection","connectionType","args","resolve","_","ctx","findUsers","query","options","limit","first","createdBy","getSaveUserMutation","outputViewer","inputFields","password","outputFields","userEdge","edgeType","user","node","cursor","viewer","mutateAndGetPayload","userArgs","param2","param3","saveUser","savedUser","getAuthTokenMutation","userNameOrEmail","authToken","success","message","console","form","authTokenArgs","getAuthToken"],"mappings":";;;;;;AAAA;;AACA;;;;AACA,IAAMA,YAAY,OAAlB,C,CAA2B;AAC3B,SAASC,UAAT,OAAkD;AAAA,QAA5BC,OAA4B,QAA5BA,OAA4B;AAAA,QAAnBC,UAAmB,QAAnBA,UAAmB;AAAA,QAAPC,GAAO,QAAPA,GAAO;;AAC9C,QAAMC,WAAW,+BAAsB;AACnCC,cAAM,MAD6B;AAEnCC,gBAAQ;AAAA,mBAAO;AACXC,oBAAI,EAAEC,4BAAF,EADO;AAEXC,0BAAU,EAAED,4BAAF,EAFC;AAGXE,uBAAO,EAAEF,4BAAF,EAHI;AAIXG,gCAAgB,EAAEH,6BAAF,EAJL;AAKXI,6BAAa,EAAEJ,4BAAF,EALF;AAMXK,wBAAQ,EAAEL,4BAAF,EANG;AAOX;AACA;AACAM,wBAAQ,EAAEN,MAAM,yBAAgBO,SAAhB,CAAR;AATG,aAAP;AAAA;AAF2B,KAAtB,CAAjB;AAcA,QAAMA,YAAY,+BAAsB;AACpCV,cAAM,QAD8B;AAEpCC,gBAAQ;AAAA,mBAAO;AACXU,0BAAU,EAAER,4BAAF,EADC;AAEXS,0BAAU,EAAET,4BAAF;AAFC,aAAP;AAAA;AAF4B,KAAtB,CAAlB;AAOA,QAAMU,iBAAiB,yCAAsB;AACzCb,cAAM,MADmC;AAEzCc,kBAAUf;AAF+B,KAAtB,CAAvB;AAIA,aAASgB,iBAAT,GAA6B;AACzB,eAAO;AACHZ,kBAAMU,eAAeG,cADlB;AAEHC,8CAFG;AAGHC,qBAAS,iBAACC,CAAD,EAAIF,IAAJ,EAAUG,GAAV,EAAkB;AACvBtB,oBAAI,eAAJ;AACA,uBAAO,+CAA4BF,QAAQyB,SAAR,CAAkB;AACjDC,2BAAO,EAD0C;AAEjDC,6BAAS,EAAEC,OAAOP,KAAKQ,KAAd,EAFwC;AAGjD5B,gCAAYuB,IAAIM;AAHiC,iBAAlB,CAA5B,EAIHT,IAJG,CAAP;AAKH;AAVE,SAAP;AAYH;AACD,aAASU,mBAAT,CAA6BC,YAA7B,EAA2C;AAAA;;AACvC,eAAO,gDAA6B;AAChC5B,kBAAM,UAD0B;AAEhC6B,yBAAa;AACT3B,oBAAI,EAAEC,4BAAF,EADK;AAETC,0BAAU,EAAED,MAAM,mDAAR,EAFD;AAGTE,uBAAO,EAAEF,MAAM,mDAAR,EAHE;AAITI,6BAAa,EAAEJ,MAAM,mDAAR,EAJJ;AAKT2B,0BAAU,EAAE3B,MAAM,mDAAR,EALD;AAMTM,wBAAQ,EAAEN,MAAM,gDAAR;AANC,aAFmB;AAUhC4B,0BAAc;AACVC,0BAAU;AACN7B,0BAAMU,eAAeoB,QADf;AAENf,6BAAS,iBAACgB,IAAD,EAAU;AACf;AACA,+BAAO,EAAEC,MAAMD,IAAR,EAAcE,QAAQF,KAAKhC,EAA3B,EAAP;AACH;AALK,iBADA;AAQVmC,wBAAQT;AARE,aAVkB;AAoBhCU;AAAA,oFAAqB,iBAAOC,QAAP,EAAiBC,MAAjB,EAAyBC,MAAzB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAEb3C,wCAAI,cAAJ,EAAoByC,QAApB;AACA;AACA;AAJa;AAAA,2CAKW3C,QAAQ8C,QAAR,CAAiB;AACrCH,0DADqC;AAErC1C,oDAAY;AAFyB,qCAAjB,CALX;;AAAA;AAKP8C,6CALO;;AASb7C,wCAAI,aAAJ,EAAmB6C,SAAnB;AATa,qEAUNA,SAVM;;AAAA;AAAA;AAAA;;AAab7C,wCAAI,oBAAJ;;AAba;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAArB;;AAAA;AAAA;AAAA;;AAAA;AAAA;AApBgC,SAA7B,CAAP;AAqCH;AACD,aAAS8C,oBAAT,CAA8BhB,YAA9B,EAA4C;AAAA;;AACxC,eAAO,gDAA6B;AAChC5B,kBAAM,cAD0B;AAEhC6B,yBAAa;AACTgB,iCAAiB,EAAE1C,MAAM,mDAAR,EADR;AAET2B,0BAAU,EAAE3B,MAAM,mDAAR;AAFD,aAFmB;AAMhC4B,0BAAc;AACVC,0BAAU;AACN7B,0BAAMU,eAAeoB,QADf;AAENf,6BAAS,iBAAC4B,SAAD,EAAe;AACpB,4BAAIA,UAAUZ,IAAV,IAAkB,IAAtB,EACI,OAAO,IAAP;AACJ,+BAAO,EAAEC,MAAMW,UAAUZ,IAAlB,EAAwBE,QAAQU,UAAUZ,IAAV,CAAehC,EAA/C,EAAP;AACH;AANK,iBADA;AASV4C,2BAAW;AACP3C,gDADO;AAEPe,6BAAS,iBAAC4B,SAAD;AAAA,+BAAeA,UAAUA,SAAzB;AAAA;AAFF,iBATD;AAaVpD,2BAAW;AACPS,6CADO;AAEPe,6BAAS;AAAA,+BAAMxB,SAAN;AAAA;AAFF,iBAbD;AAiBVqD,yBAAS;AACL5C,iDADK;AAELe,6BAAS,iBAAC4B,SAAD;AAAA,+BAAeA,UAAUA,SAAV,GAAsB,IAAtB,GAA6B,KAA5C;AAAA;AAFJ,iBAjBC;AAqBVE,yBAAS;AACL7C,gDADK;AAELe,6BAAS,iBAAC4B,SAAD;AAAA,+BAAeA,UAAUA,SAAV,GAClB,EADkB,GAElB,sCAFG;AAAA;AAFJ,iBArBC;AA2BVrC,wBAAQ;AACJN,0BAAM,yBAAgBO,SAAhB,CADF;AAEJQ,6BAAS,iBAAC4B,SAAD,EAAe;AACpBG,gCAAQnD,GAAR,CAAYgD,UAAUrC,MAAtB;AACA,+BAAOqC,UAAUrC,MAAjB;AACH;AALG,iBA3BE;AAkCV4B,wBAAQT;AAlCE,aANkB;AA0ChCU;AAAA,oFAAqB,kBAAOY,IAAP,EAAaV,MAAb,EAAqBC,MAArB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAEb3C,wCAAI,qBAAJ,EAA2BoD,IAA3B;AACMC,iDAHO,GAGS;AAClBD,kDADkB;AAElBrD;AAFkB,qCAHT;AAAA;AAAA,2CAOWD,QAAQwD,YAAR,CAAqBD,aAArB,CAPX;;AAAA;AAOPL,6CAPO;;AAQbhD,wCAAI,sBAAJ,EAA4BgD,SAA5B;AARa,sEASNA,SATM;;AAAA;AAAA;AAAA;;AAYbhD,wCAAI,oBAAJ;;AAZa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAArB;;AAAA;AAAA;AAAA;;AAAA;AAAA;AA1CgC,SAA7B,CAAP;AA0DH;AACD,WAAO;AACH6B,gDADG;AAEHZ,4CAFG;AAGH6B;AAHG,KAAP;AAKH;kBACcjD,U;AACf","file":"userSchema.js","sourcesContent":["import { GraphQLBoolean, GraphQLInt, GraphQLList, GraphQLNonNull, GraphQLObjectType, GraphQLString } from 'graphql';\r\nimport { connectionArgs, connectionDefinitions, connectionFromPromisedArray, mutationWithClientMutationId } from 'graphql-relay';\r\nconst expiresIn = 1000000; // seconds\r\nfunction UserSchema({ userApp, authedUser, log }) {\r\n    const userType = new GraphQLObjectType({\r\n        name: 'User',\r\n        fields: () => ({\r\n            id: { type: GraphQLString },\r\n            userName: { type: GraphQLString },\r\n            email: { type: GraphQLString },\r\n            emailConfirmed: { type: GraphQLBoolean },\r\n            displayName: { type: GraphQLString },\r\n            imgUrl: { type: GraphQLString },\r\n            // createdBy,\r\n            // dtChanged,\r\n            errors: { type: new GraphQLList(errorType) }\r\n        })\r\n    });\r\n    const errorType = new GraphQLObjectType({\r\n        name: 'Errors',\r\n        fields: () => ({\r\n            propName: { type: GraphQLString },\r\n            errorMsg: { type: GraphQLString },\r\n        })\r\n    });\r\n    const userConnection = connectionDefinitions({\r\n        name: 'User',\r\n        nodeType: userType\r\n    });\r\n    function getUserConnection() {\r\n        return {\r\n            type: userConnection.connectionType,\r\n            args: connectionArgs,\r\n            resolve: (_, args, ctx) => {\r\n                log('getting users');\r\n                return connectionFromPromisedArray(userApp.findUsers({\r\n                    query: {},\r\n                    options: { limit: args.first },\r\n                    authedUser: ctx.createdBy\r\n                }), args);\r\n            }\r\n        };\r\n    }\r\n    function getSaveUserMutation(outputViewer) {\r\n        return mutationWithClientMutationId({\r\n            name: 'SaveUser',\r\n            inputFields: {\r\n                id: { type: GraphQLString },\r\n                userName: { type: new GraphQLNonNull(GraphQLString) },\r\n                email: { type: new GraphQLNonNull(GraphQLString) },\r\n                displayName: { type: new GraphQLNonNull(GraphQLString) },\r\n                password: { type: new GraphQLNonNull(GraphQLString) },\r\n                errors: { type: new GraphQLList(GraphQLString) }\r\n            },\r\n            outputFields: {\r\n                userEdge: {\r\n                    type: userConnection.edgeType,\r\n                    resolve: (user) => {\r\n                        // log('ql user', user);\r\n                        return { node: user, cursor: user.id };\r\n                    }\r\n                },\r\n                viewer: outputViewer\r\n            },\r\n            mutateAndGetPayload: async (userArgs, param2, param3) => {\r\n                try {\r\n                    log('saving user:', userArgs);\r\n                    // log('saving param2:', param2);\r\n                    // log('saving param3:', param3);\r\n                    const savedUser = await userApp.saveUser({\r\n                        userArgs,\r\n                        authedUser: null\r\n                    });\r\n                    log('saved user:', savedUser);\r\n                    return savedUser;\r\n                }\r\n                catch (e) {\r\n                    log('Error saving user:', e);\r\n                }\r\n            }\r\n        });\r\n    }\r\n    function getAuthTokenMutation(outputViewer) {\r\n        return mutationWithClientMutationId({\r\n            name: 'GetAuthToken',\r\n            inputFields: {\r\n                userNameOrEmail: { type: new GraphQLNonNull(GraphQLString) },\r\n                password: { type: new GraphQLNonNull(GraphQLString) }\r\n            },\r\n            outputFields: {\r\n                userEdge: {\r\n                    type: userConnection.edgeType,\r\n                    resolve: (authToken) => {\r\n                        if (authToken.user == null)\r\n                            return null;\r\n                        return { node: authToken.user, cursor: authToken.user.id };\r\n                    }\r\n                },\r\n                authToken: {\r\n                    type: GraphQLString,\r\n                    resolve: (authToken) => authToken.authToken\r\n                },\r\n                expiresIn: {\r\n                    type: GraphQLInt,\r\n                    resolve: () => expiresIn,\r\n                },\r\n                success: {\r\n                    type: GraphQLBoolean,\r\n                    resolve: (authToken) => authToken.authToken ? true : false,\r\n                },\r\n                message: {\r\n                    type: GraphQLString,\r\n                    resolve: (authToken) => authToken.authToken\r\n                        ? ''\r\n                        : 'Auth Failed, review your credentials',\r\n                },\r\n                errors: {\r\n                    type: new GraphQLList(errorType),\r\n                    resolve: (authToken) => {\r\n                        console.log(authToken.errors);\r\n                        return authToken.errors;\r\n                    }\r\n                },\r\n                viewer: outputViewer\r\n            },\r\n            mutateAndGetPayload: async (form, param2, param3) => {\r\n                try {\r\n                    log('getAuthToken input:', form);\r\n                    const authTokenArgs = {\r\n                        form,\r\n                        authedUser\r\n                    };\r\n                    const authToken = await userApp.getAuthToken(authTokenArgs);\r\n                    log('getAuthToken return:', authToken);\r\n                    return authToken;\r\n                }\r\n                catch (e) {\r\n                    log('Error saving user:', e);\r\n                }\r\n            }\r\n        });\r\n    }\r\n    return {\r\n        getSaveUserMutation,\r\n        getUserConnection,\r\n        getAuthTokenMutation\r\n    };\r\n}\r\nexport default UserSchema;\r\n//# sourceMappingURL=userSchema.js.map"]}